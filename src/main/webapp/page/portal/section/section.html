<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>薄荷社区</title>
    <link rel="icon" href="/image/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="fly,layui,前端社区">
    <meta name="description" content="Fly社区是模块化前端UI框架Layui的官网社区，致力于为web开发提供强劲动力">
    <link rel="stylesheet" href="../../../script/layui/css/layui.css">
    <link rel="stylesheet" href="../../../css/global.css">
    <script src="/script/jquery-3.3.1.min.js"></script>
</head>
<body>

<div class="fly-header layui-bg-black">
    <div class="layui-container">
        <a class="fly-logo" href="/">
            <img src="../../../image/logo.png" alt="layui">
        </a>
        <ul class="layui-nav fly-nav layui-hide-xs">
            <li class="layui-nav-item layui-this">
                <a href="/"><i class="iconfont icon-jiaoliu"></i>业主论坛</a>
            </li>
            <li class="layui-nav-item">
                <a href="/page/portal/market/market.html"><i class="iconfont icon-iconmingxinganli"></i>交易市场</a>
            </li>
            <li class="layui-nav-item">
                <a href="http://www.layui.com/" target="_blank"><i class="iconfont icon-ui"></i>吐槽区</a>
            </li>
        </ul>

        <!-- 用户个人中心功能区 -->
        <ul class="layui-nav fly-nav-user">
            <!-- 登入后的状态 -->
            <li class="layui-nav-item">
                <!--个人中心-->
                <a class="fly-nav-avatar" href="javascript:;" id="center"></a>
                <dl class="layui-nav-child">
                    <dd>
                        <a href="../user/home.html"><i class="layui-icon" style="margin-left: 2px; font-size: 22px;">&#xe68e;</i>我的主页</a>
                    </dd>
                    <dd>
                        <a href="../user/message.html"><i class="iconfont icon-tongzhi" style="top: 4px;"></i>我的消息</a>
                    </dd>
                    <dd>
                        <a href="../user/setting.html"><i class="layui-icon">&#xe620;</i>基本设置</a>
                    </dd>
                    <hr style="margin: 5px 0;">
                    <dd><a href="" style="text-align: center;">退出</a></dd>
                </dl>
            </li>
        </ul>
    </div>
</div>

<div class="fly-panel fly-column">
    <!--板块导航及帖子模块功能区-->
    <div class="layui-container" id="guide_bar"></div>
</div>

<div class="layui-container">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md8">
            <div class="fly-panel" style="margin-bottom: 0;">

                <div class="fly-panel-title fly-filter">
                    <a href="javascript:getAllPost()" id="total" class="layui-this">综合</a>
                    <span class="fly-mid"></span>
                    <a href="javascript:getBestPost()" id="best">精华</a>
                    <span class="fly-filter-right layui-hide-xs">
                        <a href="javascript:getPostByPtime()" class="layui-this" id="new">按最新</a>
                        <span class="fly-mid"></span>
                        <a href="javascript:getPostByRcount()" id="hot">按热议</a>
                    </span>
                </div>

                <ul class="fly-list" id="post"></ul>

                <!-- <div class="fly-none">没有相关数据</div> -->

                <div style="text-align: center">
                    <!--<div class="layui-laypage">-->
                    <!--<span class="laypage-curr">1</span>-->
                    <!--<a href="/jie/page/2/">2</a>-->
                    <!--<a href="/jie/page/3/">3</a>-->
                    <!--<a href="/jie/page/4/">4</a>-->
                    <!--<a href="/jie/page/5/">5</a>-->
                    <!--<span>…</span>-->
                    <!--<a href="/jie/page/148/" class="laypage-last" title="尾页">尾页</a>-->
                    <!--<a href="/jie/page/2/" class="laypage-next">下一页</a>-->
                    <!--</div>-->
                    <div id="page"></div>
                </div>

            </div>
        </div>

        <div class="layui-col-md4">

            <!--热门帖子模块-->
            <dl class="fly-panel fly-list-one" id="hot_post"></dl>

            <!--社区工具栏模块-->
            <div class="fly-panel">
                <div class="fly-panel-title">
                    社区工具栏
                </div>
                <div class="fly-panel-main">
                    <a href="" target="_blank" class="fly-zanzhu"
                       time-limit="2017.09.25-2099.01.01" style="background-color: #5FB878;">车牌号查询</a>
                </div>
            </div>

            <div class="fly-panel fly-link">
                <h3 class="fly-panel-title">友情链接</h3>
                <dl class="fly-panel-main">
                    <dd><a href="http://www.layui.com/" target="_blank">layui</a>
                    <dd>
                    <dd><a href="http://layim.layui.com/" target="_blank">WebIM</a>
                    <dd>
                    <dd><a href="http://layer.layui.com/" target="_blank">layer</a>
                    <dd>
                    <dd><a href="http://www.layui.com/laydate/" target="_blank">layDate</a>
                    <dd>
                    <dd>
                        <a href="mailto:xianxin@layui-inc.com?subject=%E7%94%B3%E8%AF%B7Fly%E7%A4%BE%E5%8C%BA%E5%8F%8B%E9%93%BE"
                           class="fly-link">申请友链</a>
                    <dd>
                </dl>
            </div>

        </div>
    </div>
</div>
<div class="fly-footer">
    <p>
        <a href="http://fly.layui.com/" target="_blank">薄荷社区</a> 2019 &copy;
        <a href="http://www.layui.com/" target="_blank">橙色薄荷° 出品</a>
    </p>
    <p>
        <a href="http://fly.layui.com/jie/3147/" target="_blank">Copyright &copy; 2019 橙色薄荷° All Rights Reserved.</a>
    </p>
</div>
<script src="../../../script/layui/layui.js"></script>
<script>
    layui.cache.page = 'jie';
    layui.cache.user = {
        username: '游客',
        uid: -1,
        avatar: '/image/avatar/00.jpg',
        experience: 83,
        sex: '男'
    };
    layui.config({
        version: "3.0.0"
        , base: '/script/mods/'
    }).extend({
        fly: 'index'
    }).use('fly');
</script>
<!--导航栏模板-->
<script id="m_guide_bar" type="text/html">
    <ul class="layui-clear">
        {{# layui.each(d, function(index, item){ }}
        {{# if(item.sid === section && section==='index'){ }}
        <li class="layui-hide-xs layui-this">
            <a href="/index.html">{{item.sname}}</a>
        </li>
        {{#} else if(item.sid === 'index'){}}
        <li class="layui-hide-xs">
            <a href="/index.html">{{item.sname}}</a>
        </li>
        {{#} else if(item.sid === section){}}
        <li class="layui-hide-xs layui-this">
            <a href="/page/portal/section/section.html?sid={{item.sid}}">{{item.sname}}</a>
        </li>
        {{#} else {}}
        <li><a href="/page/portal/section/section.html?sid={{item.sid}}">{{item.sname}}</a></li>
        {{# } }}
        {{# }); }}
        <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><span class="fly-mid"></span></li>
        <!--用户登入后显示-->
        <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><a href="user/index.html">我的贴子</a></li>
        <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><a
                href="user/index.html#collection">收藏</a>
        </li>
    </ul>
    <div class="fly-column-right layui-hide-xs">
            <span class="fly-search">
                <i class="layui-icon"></i>
            </span>
        <a href="page/portal/topic/add.html?section=123" class="layui-btn">发表新帖</a>
    </div>
    <!--<div class="layui-hide-sm layui-show-xs-block"-->
    <!--style="margin-top: -10px; padding-bottom: 10px; text-align: center;">-->
    <!--<a href="jie/add.html" class="layui-btn">发表新帖</a>-->
    <!--</div>-->
</script>

<!--用户中心模板-->
<script id="m_center" type="text/html">
    <cite class="layui-hide-xs">{{ d.nickname }}</cite>
    {{#  if(d.role === 1){ }}
    <i class="iconfont icon-renzheng layui-hide-xs" title="认证信息：管理员"></i>
    <i class="layui-badge fly-badge-vip layui-hide-xs" title="积分 {{d.point}}">Lv.3</i>
    {{#  } }}
    <img src="{{ d.profile }}">
</script>

<!--热门帖子模板-->
<script type="text/html" id="m_hot_post">
    <dt class="fly-panel-title">本周热议</dt>
    <dl class="fly-panel-main">
        {{# if(d.length>0){ }}
        {{# for(var i = 0 ; i < d.length; i++){ }}
        <dd>
            <a href="jie/detail.html">{{ d[i].title }}</a>
            <span><i class="iconfont icon-pinglun1"></i> {{ d[i].acount+d[i].rcount }}</span>
        </dd>
        {{# } }}
        {{# } }}
    </dl>
    {{# if(d.length===0){ }}
    <!-- 无数据时 -->
    <div class="fly-none">没有相关数据</div>
    {{# } }}
</script>

<script type="text/html" id="m_post">
    {{# layui.each(d, function(index, item){ }}
    <li>
        <a href="../user/home.html" class="fly-avatar">
            <img src="../../../image/asuna.jpg"
                 alt="橙色薄荷°">
        </a>
        <h2>
            <a class="layui-badge">{{item.sname}}</a>
            <a href="../forum/detail.html">{{item.post.title}}</a>
        </h2>
        <div class="fly-list-info">
            <a href="../user/home.html" link>
                <cite>{{item.nickname}}</cite>
                <!--
                <i class="iconfont icon-renzheng" title="认证信息：XXX"></i>
                <i class="layui-badge fly-badge-vip">管理员</i>
                -->
            </a>
            <span>{{item.post.ptime}}</span>

            <span class="layui-hide-xs" title="浏览"><i class="iconfont icon-liulanyanjing"></i> {{item.post.acount}}</span>
            <!--<span class="layui-badge fly-badge-accept layui-hide-xs">已结</span>-->
            <span class="fly-list-nums">
                <i class="iconfont icon-pinglun1" title="回答"></i> {{item.post.rcount}}
            </span>
        </div>
        <div class="fly-list-badge">
            <span class="layui-badge layui-bg-black">置顶</span>
            <!--<span class="layui-badge layui-bg-red">精帖</span>-->
        </div>
    </li>
    {{# }); }}
</script>

<!--<script type="text/html" id="m_post1">-->
    <!--{{# for(var i = 0 ; i < d.length; i++){ }}-->
    <!--<li>-->
        <!--<a href="../user/home.html" class="fly-avatar">-->
            <!--<img src="../../../image/asuna.jpg"-->
                 <!--alt="橙色薄荷°">-->
        <!--</a>-->
        <!--<h2>-->
            <!--<a class="layui-badge">{{ d[i].sname }}</a>-->
            <!--<a href="../forum/detail.html">{{ d[i].post.title }}</a>-->
        <!--</h2>-->
        <!--<div class="fly-list-info">-->
            <!--<a href="../user/home.html" link>-->
                <!--<cite>{{ d[i].nickname }}</cite>-->
                <!--&lt;!&ndash;-->
                <!--<i class="iconfont icon-renzheng" title="认证信息：XXX"></i>-->
                <!--<i class="layui-badge fly-badge-vip">管理员</i>-->
                <!--&ndash;&gt;-->
            <!--</a>-->
            <!--<span></span>-->

            <!--<span class="fly-list-kiss layui-hide-xs" title="悬赏飞吻"><i class="iconfont icon-kiss"></i> </span>-->
            <!--&lt;!&ndash;<span class="layui-badge fly-badge-accept layui-hide-xs">已结</span>&ndash;&gt;-->
            <!--<span class="fly-list-nums">-->
                <!--<i class="iconfont icon-pinglun1" title="回答"></i>-->
            <!--</span>-->
        <!--</div>-->
        <!--<div class="fly-list-badge">-->
            <!--<span class="layui-badge layui-bg-black">置顶</span>-->
            <!--&lt;!&ndash;<span class="layui-badge layui-bg-red">精帖</span>&ndash;&gt;-->
        <!--</div>-->
    <!--</li>-->
    <!--{{# } }}-->
<!--</script>-->

<!--获取数据，渲染模板-->
<script type="text/javascript">

    function getQueryParameter(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }

    var section = getQueryParameter("sid");

    var user_info;
    $.ajax({
        type: 'post',
        url: '/user/userCenter.do',
        data: {},
        dataType: 'json',
        async: false,
        success: function (data) {
            user_info = data.data;
        },
        error: function (data) {
            alert("获取公告板失败！");
        }
    })

    var guide_bar;
    $.ajax({
        type: 'post',
        url: '/section/getSection.do',
        dataType: 'json',
        async: false,
        success: function (data) {
            guide_bar = data.data;
        },
        error: function (data) {
            alert("获取论坛版块失败！");
        }
    })

    var hot_post;
    $.ajax({
        type: 'post',
        url: '/post/getSectionHotPost.do',
        dataType: 'json',
        data: {
            section: section,
        },
        async: false,
        success: function (data) {
            hot_post = data.data;
        },
        error: function (data) {
            alert("获取热门模块失败！");
        }
    })

    layui.use('laytpl', function () {
        laytpl = layui.laytpl;
        // 板块导航渲染
        var guide_bar_model = document.getElementById('m_guide_bar').innerHTML;
        var guide_bar_view = document.getElementById('guide_bar');
        laytpl(guide_bar_model).render(guide_bar, function (html) {
            guide_bar_view.innerHTML = html;
        });
        // 用户中心渲染
        var center_model = document.getElementById('m_center').innerHTML;
        var center_view = document.getElementById('center');
        laytpl(center_model).render(user_info, function (html) {
            center_view.innerHTML = html;
        });
        // 热门帖子渲染
        var hot_post_model = document.getElementById('m_hot_post').innerHTML;
        var hot_post_view = document.getElementById('hot_post');
        laytpl(hot_post_model).render(hot_post, function (html) {
            hot_post_view.innerHTML = html;
        });
    });
</script>
<script>

    // 根据发帖时间获取帖子列表
    var order = 'ptime';
    // 获取本板块全部类型的帖子
    var kind = 'all';


    // 跳转到或刷新页面获取分页数据
    getPageData();

    function getAllPost() {
        kind = "all";
        $("#total").addClass("layui-this");
        $("#best").removeClass("layui-this");
        getPageData();
    }

    function getBestPost() {
        kind = "isbest";
        $("#best").addClass("layui-this");
        $("#total").removeClass("layui-this");
        getPageData();
    }

    function getPostByPtime() {
        order = "ptime";
        $("#new").addClass("layui-this");
        $("#hot").removeClass("layui-this");
        getPageData();
    }

    function getPostByRcount() {
        order = "rcount";
        $("#hot").addClass("layui-this");
        $("#new").removeClass("layui-this");
        layer.msg(order);
        getPageData();
    }

    function getPageData() {
        layui.use(['laypage', 'layer'], function () {
            var laypage = layui.laypage, layer = layui.layer;
            //自定义每页条数的选择项
            laypage.render({
                elem: 'page',
                count: 3,
                limit: 1,
                limits: [1, 2, 5],
                layout: ['prev', 'page', 'next', 'limit', 'refresh', 'skip'],
                // theme: 'main',
                jump: function (obj, first) {
                    var data_list;
                    $.ajax({
                        type: 'post',
                        url: '/post/getSectionPostWithPage.do',
                        dataType: 'json',
                        data: {
                            section: section,
                            kind: kind,
                            order: order,
                            page: obj.curr,
                            limit: obj.limit,
                        },
                        async: false,
                        success: function (data) {
                            data_list = data.data;
                        },
                        error: function (data) {
                            layer.msg("获取帖子失败！");
                        }
                    })
                    layui.use('laytpl', function () {
                        laytpl = layui.laytpl;
                        // 帖子模块渲染
                        var post_model = document.getElementById('m_post').innerHTML;
                        var post_view = document.getElementById('post');
                        laytpl(post_model).render(data_list, function (html) {
                            post_view.innerHTML = html;
                        });

                    });
                }
            });
        })
    }
</script>
</body>
</html>