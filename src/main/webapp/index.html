<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>薄荷社区-首页</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="薄荷社区">
    <meta name="description" content="薄荷社区,MintBBS,橙色薄荷°">
    <link rel="icon" href="/image/favicon.ico">
    <link rel="stylesheet" href="/script/layui/css/layui.css">
    <link rel="stylesheet" href="/css/global.css">
    <script src="/script/jquery-3.3.1.min.js"></script>

</head>
<body>
<!--头部-->
<div class="fly-header layui-bg-black">
    <div class="layui-container">
        <a class="fly-logo" href="/">
            <img src="/image/logo.png" alt="layui">
        </a>
        <!-- 论坛主标题区 -->
        <ul class="layui-nav fly-nav layui-hide-xs">
            <li class="layui-nav-item layui-this">
                <a href="/"><i class="iconfont icon-jiaoliu"></i>论坛</a>
            </li>
            <li class="layui-nav-item">
                <a href="/page/portal/market/market.html"><i class="iconfont icon-iconmingxinganli"></i>市场</a>
            </li>
            <li class="layui-nav-item">
                <a href="/page/portal/weibo/index.html"><i class="iconfont icon-ui"></i>微博</a>
            </li>
        </ul>
        <!-- 用户个人中心功能区 -->
        <ul class="layui-nav fly-nav-user">
            <!-- 登入后的状态 -->
            <li class="layui-nav-item" id="center">
            </li>
        </ul>
    </div>
</div>

<div class="fly-panel fly-column">
    <!--板块导航及帖子模块功能区-->
    <div class="layui-container" id="guide_bar"></div>
</div>

<div class="layui-container">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md8">
            <div class="fly-panel">
                <div class="fly-panel-title fly-filter">
                    <a>置顶</a>
                    <a href="#signin" class="layui-hide-sm layui-show-xs-block fly-right" id="LAY_goSignin"
                       style="color: #FF5722;">去签到</a>
                </div>
                <ul class="fly-list" id="sticky">

                </ul>
            </div>
            <!--第二板块：回帖-->
            <div class="fly-panel" style="margin-bottom: 0;">
                <div class="fly-panel-title fly-filter">
                    <a href="javascript:getAllPost()" id="total" class="layui-this">综合</a>
                    <span class="fly-mid"></span>
                    <a href="javascript:getBestPost()" id="best">精华</a>
                    <span class="fly-filter-right layui-hide-xs">
                        <a href="javascript:getPostByPtime()" class="layui-this" id="new">最新</a>
                        <span class="fly-mid"></span>
                        <a href="javascript:getPostByRcount()" id="hot">热议</a>
                    </span>
                </div>

                <!--帖子列表区-->
                <ul class="fly-list" id="post"></ul>

                <div style="text-align: center">
                    <div class="laypage-main">
                        <a class="laypage-next" href="javascript:getMore()">更多帖子</a>
                    </div>
                </div>

            </div>
        </div>
        <div class="layui-col-md4">

            <div class="fly-panel">
                <h3 class="fly-panel-title">社区公告</h3>
                <ul class="fly-panel-main fly-list-static" id="notice"></ul>
            </div>

            <div class="fly-panel fly-signin" id="checkin">
                <div class="fly-panel-title">
                    签到
                    <i class="fly-mid"></i>
                    <a href="javascript:;" class="fly-link checkinHelp">说明</a>
                    <i class="fly-mid"></i>
                    <span class="fly-signin-days">已连续签到<cite>0</cite>天</span>
                </div>
                <div class="fly-panel-main fly-signin-main">
                    <button class="layui-btn layui-btn-danger" onclick="checkin()">签到</button>
                    <span>可获得<cite>5</cite>薄荷币</span>
                </div>
            </div>

            <div class="fly-panel fly-rank fly-rank-reply" id="LAY_replyRank">
                <h3 class="fly-panel-title">回帖榜</h3>
                <dl id="active_user"></dl>
            </div>

            <dl class="fly-panel fly-list-one" id="hot_post"></dl>

            <!--            <div class="fly-panel">-->
            <!--                <div class="fly-panel-title">-->
            <!--                    社区工具栏-->
            <!--                </div>-->
            <!--                <div class="fly-panel-main">-->
            <!--                    <a href="" target="_blank" class="fly-zanzhu"-->
            <!--                       time-limit="2017.09.25-2099.01.01" style="background-color: #5FB878;">车牌号查询</a>-->
            <!--                    <a href="" target="_blank" class="fly-zanzhu"-->
            <!--                       time-limit="2017.09.25-2099.01.01" style="background-color: #5FB878;">社区选举投票</a>-->
            <!--                </div>-->
            <!--            </div>-->
            <div class="fly-panel">
                <div class="fly-panel-title">
                    社区工具栏
                </div>
                <div class="fly-panel-main">
                    <button class="fly-zanzhu tool" data-method="offset"
                            time-limit="2017.09.25-2099.01.01" style="background-color: #5FB878;width: 100%;border: 0">
                        车牌号查询
                    </button>
                    <a class="fly-zanzhu tool" data-method="offset" href=""
                       time-limit="2017.09.25-2099.01.01" style="background-color: #5FB878;">社区选举投票</a>
                </div>
            </div>

            <div class="fly-panel fly-list-one">
                <dt class="fly-panel-title">社区管理组</dt>
                <dl class="fly-panel-main">
                    <!--<table>-->
                    <!--<tr>-->
                    <!--<td>-->
                    <!--<dd>-->
                    <!--居委会：-->
                    <!--</dd>-->
                    <!--</td>-->
                    <!--<td>-->
                    <!--<dd>橙色薄荷°——17863909380</dd>-->
                    <!--</td>-->
                    <!--</tr>-->
                    <!--<tr>-->
                    <!--<td>-->
                    <!--<dd>-->
                    <!--物业：-->
                    <!--</dd>-->
                    <!--</td>-->
                    <!--<td>-->
                    <!--<dd>橙色薄荷°——17863909380</dd>-->
                    <!--</td>-->
                    <!--</tr>-->
                    <!--<tr>-->
                    <!--<td>-->
                    <!--<dd>-->
                    <!--保卫处：-->
                    <!--</dd>-->
                    <!--</td>-->
                    <!--<td>-->
                    <!--<dd>橙色薄荷°——17863909380</dd>-->
                    <!--</td>-->
                    <!--</tr>-->
                    <!--<tr>-->
                    <!--<td>-->
                    <!--<dd>-->
                    <!--值班室：-->
                    <!--</dd>-->
                    <!--</td>-->
                    <!--<td>-->
                    <!--<dd>橙色薄荷°——17863909380</dd>-->
                    <!--</td>-->
                    <!--</tr>-->
                    <!--</table>-->
                    <dd>
                        <a href="http://layim.layui.com/" target="_blank">居委会：橙色薄荷°—17863909380</a>
                    </dd>
                    <dd>
                        <a href="http://layim.layui.com/" target="_blank">物业处：橙色薄荷°—17863909380</a>
                    </dd>
                    <dd>
                        <a href="http://layer.layui.com/" target="_blank">保卫处：橙色薄荷°—17863909380</a>
                    </dd>
                    <dd>
                        <a href="http://layer.layui.com/" target="_blank">值班室：橙色薄荷°—17863909380</a>
                    </dd>
                    <dd>
                        <a href="mailto:amamiya7@163.com">商务洽谈：邮件—amamiya7@163.com</a>
                    </dd>
                </dl>
            </div>
        </div>
    </div>
</div>

<div class="fly-footer">
    <p>
        <a href="http://fly.layui.com/" target="_blank">薄荷社区</a> 2019 &copy;
        <a href="http://www.layui.com/" target="_blank">橙色薄荷° 出品</a>
    </p>
    <p>
        <a href="http://fly.layui.com/jie/3147/" target="_blank">Copyright &copy; 2019 橙色薄荷° All Rights Reserved.</a>
    </p>
</div>

<script src="/script/layui/layui.js"></script>
<script src="/script/moment.min.js"></script>
<script>
    layui.cache.page = '';
    layui.cache.user = {
        username: '游客'
        , uid: -1
        , avatar: '/image/avatar/00.jpg'
        , experience: 83
        , sex: '男'
    };
    layui.config({
        version: "3.0.0"
        , base: '/script/mods/' //这里实际使用时，建议改成绝对路径
    }).extend({
        fly: 'index'
    }).use('fly');
</script>

<!--<script type="text/javascript">-->
<!--var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");-->
<!--document.write(unescape("%3Cspan id='cnzz_stat_icon_30088308'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "w.cnzz.com/c.php%3Fid%3D30088308' type='text/javascript'%3E%3C/script%3E"));-->
<!--</script>-->
</body>

<!--用户中心模板-->
<script id="m_center" type="text/html">
    <a class="fly-nav-avatar" href="javascript:;">
        <cite>{{ d.nickname }}</cite>
        {{# if(d.role === 1){ }}
        <i class="iconfont icon-renzheng layui-hide-xs" title="认证信息：管理员"></i>
        {{# } }}
        <i class="layui-badge fly-badge-vip layui-hide-xs" title="薄荷币 {{d.point}}">{{d.point}}MC</i>
        <img src="{{d.profile}}">
    </a>
    <dl class="layui-nav-child">
        <dd>
            <a href="/page/portal/user/home.html?user={{d.uid}}"><i class="layui-icon"
                                                                    style="margin-left: 2px; font-size: 22px;">&#xe68e;</i>我的主页</a>
        </dd>
        <dd>
            <a href="/page/portal/user/message.html"><i class="iconfont icon-tongzhi" style="top: 4px;"></i>我的消息</a>
        </dd>
        <dd>
            <a href="/page/portal/user/setting.html"><i class="layui-icon">&#xe620;</i>基本设置</a>
        </dd>
        <hr style="margin: 5px 0;">
        <dd><a href="" style="text-align: center;">退出</a></dd>
    </dl>
</script>

<!--签到模块模板-->
<script id="m_checkin" type="text/html">
    <div class="fly-panel-title">
        签到
        <i class="fly-mid"></i>
        <a href="javascript:;" class="fly-link checkinHelp">说明</a>
        <i class="fly-mid"></i>
        {{# if(isYesterday(d.ctime)||isToday(d.ctime)){ }}
        <span class="fly-signin-days">已连续签到<cite>{{d.days}}</cite>天</span>
        {{#} else {}}
        <span class="fly-signin-days">已连续签到<cite>0</cite>天</span>
        {{# } }}
    </div>
    <div class="fly-panel-main fly-signin-main">
        {{# if(isToday(d.ctime)){ }}
        <!-- 已签到状态 -->
        <button class="layui-btn layui-btn-disabled">已签到</button>
        <span>获得了<cite>{{point(d.days)}}</cite>薄荷币(MC)</span>
        {{#} else {}}
        <button class="layui-btn layui-btn-danger" id="LAY_signin" onclick="checkin()">签到</button>
        <span>可获得<cite>{{point(d.days)}}</cite>薄荷币(MC)</span>
        {{# } }}
    </div>
</script>

<!--导航栏模板-->
<script id="m_guide_bar" type="text/html">
    <ul class="layui-clear">
        {{# layui.each(d, function(index, item){ }}
        {{# if(item.sname ==='首页'){ }}
        <li class="layui-hide-xs layui-this">
            <a href="/index.html">{{item.sname}}</a>
        </li>
        {{#} else {}}
        <li><a href="/page/portal/section/section.html?section={{item.sid}}">{{item.sname}}</a></li>
        {{# } }}
        {{# }); }}
        <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><span class="fly-mid"></span></li>
        <!--用户登入后显示-->
        <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><a href="/page/portal/user/post.html#index">我的帖子</a>
        </li>
        <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><a
                href="/page/portal/user/post.html#collection">收藏</a>
        </li>
    </ul>
    <div class="fly-column-right layui-hide-xs">
        <!--            <span class="fly-search">-->
        <!--                <i class="layui-icon layui-icon-search"></i>-->
        <!--            </span>-->
        <a href="/page/portal/topic/add.html" class="layui-btn">发表新帖</a>
    </div>
    <div class="layui-hide-sm layui-show-xs-block"
         style="margin-top: -10px; padding-bottom: 10px; text-align: center;">
        <a href="/page/portal/topic/add.html" class="layui-btn">发表新帖</a>
    </div>
</script>

<!--公告板模板-->
<script id="m_notice" type="text/html">
    {{# layui.each(d, function(index, item){ }}
    <li>

        <a href="/page/portal/topic/detail.html?post={{item.tid}}&section={{item.sid}}" target="_blank">
            {{ item.title }}
        </a>
        <!--<span>{{ item.ptime }}</span>-->

    </li>
    {{# }); }}
    {{# if(d.length===0){ }}
    <!-- 无数据时 -->
    <li><a>暂无相关数据</a></li>
    {{# } }}
</script>

<!-- 帖子模板 -->
<script id="m_post" type="text/html">
    {{# layui.each(d, function(index, item){ }}
    <li>
        <a href="/page/portal/user/home.html?user={{item.uid}}" class="fly-avatar">
            <img src="{{item.profile}}"
                 alt="{{item.nickname}}">
        </a>
        <!--<h2 class="layui-hide-sm layui-show-xs-block">-->
        <!--<a class="layui-badge">{{item.sname}}</a>-->
        <!--{{# if(item.issticky===1&&item.isbest===1){ }}-->
        <!--<a href="/page/portal/topic/detail2.html?post={{item.tid}}&section={{item.sid}}" style="max-width: 50%">-->
        <!--{{item.title}}-->
        <!--</a>-->
        <!--{{#} else if((item.issticky===1&&item.isbest!==1)||(item.issticky!==1&&item.isbest===1)){ }}-->
        <!--<a href="/page/portal/topic/detail2.html?post={{item.tid}}&section={{item.sid}}" style="max-width: 65%">-->
        <!--{{item.title}}-->
        <!--</a>-->
        <!--{{#} else { }}-->
        <!--<a href="/page/portal/topic/detail2.html?post={{item.tid}}&section={{item.sid}}">-->
        <!--{{item.title}}-->
        <!--</a>-->
        <!--{{# } }}-->
        <!--</h2>-->
        <h2>
            <a class="layui-badge">{{item.sname}}</a>
            <a href="/page/portal/topic/detail.html?post={{item.tid}}&section={{item.sid}}">
                {{item.title}}
            </a>
        </h2>
        <div class="fly-list-info">
            <a href="../user/home.html" link>
                <cite>{{item.nickname}}</cite>
                {{# if(item.role==='1'){ }}
                <i class="iconfont icon-renzheng" title="认证信息：管理员"></i>
                {{# } }}
                <i class="layui-badge fly-badge-level">{{item.point}}MC</i>
            </a>
            <span>{{item.ptime}}</span>

            <span class="layui-hide-xs" title="浏览">
                <i class="iconfont icon-liulanyanjing"></i> {{item.acount}}
            </span>
            <span class="fly-list-nums">
                <i class="iconfont icon-praise layui-hide-xs" title="赞"></i> {{item.pcount}}
                <i class="iconfont icon-pinglun1" title="回复"></i> {{item.rcount}}
            </span>
        </div>
        <div class="fly-list-badge">
            {{# if(item.issticky==='1'){ }}
            <span class="layui-badge layui-bg-black">置顶</span>
            {{# } }}
            {{# if(item.isbest==='1'){ }}
            <span class="layui-badge layui-bg-red">精华</span>
            {{# } }}
        </div>
    </li>
    {{# }); }}
    {{# if(d.length===0){ }}
    <!-- 无数据时 -->
    <li>
        暂无相关数据
    </li>
    {{# } }}
</script>

<!--热门帖子模板-->
<script type="text/html" id="m_hot_post">
    <dt class="fly-panel-title">本周热议</dt>
    <dl class="fly-panel-main">
        {{# if(d.length>0){ }}
        {{# for(var i = 0 ; i < d.length; i++){ }}
        <dd>
            <a href="jie/detail.html">{{ d[i].title }}</a>
            <span><i class="iconfont icon-pinglun1"></i> {{ d[i].acount+d[i].rcount }}</span>
        </dd>
        {{# } }}
        {{# } }}
    </dl>
    {{# if(d.length===0){ }}
    <!-- 无数据时 -->
    <div class="fly-none">没有相关数据</div>
    {{# } }}
</script>

<!--活跃用户榜单模板-->
<script type="text/html" id="m_active_user">
    {{# if(d.length===0){ }}
    <dd>
        <!-- 无数据时 -->
        <div class="fly-none">暂无数据</div>
    </dd>
    {{# } }}
    {{# layui.each(d, function(index, item){ }}
    <dd>
        <a href="/page/portal/user/home.html?user={{item.uid}}">
            <img src="{{item.profile}}"><cite>{{item.nickname}}</cite><i>活跃度 {{item.count}}</i>
        </a>
    </dd>
    {{# }); }}
</script>

<script>

    // 根据发帖时间获取帖子列表
    var order = 'ptime';
    // 获取本板块全部类型的帖子
    var kind = 'all';

    function isToday(date) {
        var today = moment().format("YYYY年MM月DD日");
        var d = moment(date).format('YYYY年MM月DD日');
        return d == today;
    }

    function isYesterday(date) {
        var yesterday = moment().add(-1, 'days').format('YYYY年MM月DD日');
        var d = moment(date).format('YYYY年MM月DD日');
        return d == yesterday;
    }

    function point(days) {
        if (days > 0 && days < 5) {
            return 5;
        } else if (days >= 5 && days < 15) {
            return 10;
        } else if (days >= 15 && days < 30) {
            return 15;
        } else {
            return 20;
        }
    }

    function getAllPost() {
        kind = "all";
        $("#total").addClass("layui-this");
        $("#best").removeClass("layui-this");
        firstGetData();
    }

    function getBestPost() {
        kind = "isbest";
        $("#best").addClass("layui-this");
        $("#total").removeClass("layui-this");
        firstGetData();
    }

    function getPostByPtime() {
        order = "ptime";
        $("#new").addClass("layui-this");
        $("#hot").removeClass("layui-this");
        9

        firstGetData();
    }

    function getPostByRcount() {
        order = "rcount";
        $("#hot").addClass("layui-this");
        $("#new").removeClass("layui-this");
        firstGetData();
    }

    function firstGetData() {
        page = 1;
        $.ajax({
            type: 'post',
            url: '/post/getPostByPtime.do',
            dataType: 'json',
            data: {
                page: page,
                kind: kind,
                order: order
            },
            async: false,
            success: function (data) {
                post = data.data;
                // layer.msg("123456789");
                page++;
            },
            error: function (data) {
                // layer.msg("获取帖子列表失败！");
            }
        })
        layui.use('laytpl', function () {
            laytpl = layui.laytpl;
            // 帖子列表渲染
            var post_model = document.getElementById('m_post').innerHTML;
            var post_view = document.getElementById('post');
            laytpl(post_model).render(post, function (html) {
                // 当前只写了获取之前当前页所有数据的方法，是否使用追加有待商讨
                // 更新innerHTML，获取数据量越来越大，需要获取当前页之前所有数据，适用于实时更新
                post_view.innerHTML = html;
                // 追加innerHTML，获取数据量小，只用获取新页面的数据，适用于不实时更新
                // post_view.innerHTML += html;
            });

        });
    }

    function checkin() {
        $.ajax({
            type: 'post',
            url: '/checkin/checkin.do',
            dataType: 'json',
            async: false,
            success: function (data) {
                layer.msg(data.msg, function () {
                    // 帖子列表数据
                    var checkin;
                    // ajax-获取帖子列表
                    $.ajax({
                        type: 'post',
                        url: '/checkin/getUserCheckinInfo.do',
                        dataType: 'json',
                        async: false,
                        success: function (data) {
                            checkin = data.data;
                        },
                        error: function (data) {
                            layer.msg("调取【获取签到信息】服务失败！");
                        }
                    })
                    // 模板引擎渲染
                    layui.use(['laytpl'], function () {
                        // 定义一个模板引擎
                        laytpl = layui.laytpl;
                        // 签到模块渲染
                        if (checkin !== null) {
                            var checkin_model = document.getElementById('m_checkin').innerHTML;
                            var checkin_view = document.getElementById('checkin');
                            laytpl(checkin_model).render(checkin, function (html) {
                                checkin_view.innerHTML = html;
                            });
                        }
                    });
                });
            },
            error: function (data) {
                layer.msg("调取【签到】服务失败！");
            }
        })
    }

    var page = 1;

    function getMore() {
        $.ajax({
            type: 'post',
            url: '/post/getPostByPtime.do',
            dataType: 'json',
            data: {
                kind: kind,
                order: order,
                page: page
            },
            async: false,
            success: function (data) {
                post = data.data;
                page++;
            },
            error: function (data) {
                alert("获取帖子失败！");
            }
        })
        layui.use('laytpl', function () {
            laytpl = layui.laytpl;
            // 帖子列表渲染
            var post_model = document.getElementById('m_post').innerHTML;
            var post_view = document.getElementById('post');
            laytpl(post_model).render(post, function (html) {
                // 当前只写了获取之前当前页所有数据的方法，是否使用追加有待商讨
                // 更新innerHTML，获取数据量越来越大，需要获取当前页之前所有数据，适用于实时更新
                post_view.innerHTML = html;
                // 追加innerHTML，获取数据量小，只用获取新页面的数据，适用于不实时更新
                // post_view.innerHTML += html;
            });

        });
    }

    // 通过地址栏获取当前板块唯一标识
    // 主页唯一标识
    var section = 'post.html';

    // 通过地址栏获取当前板块唯一标识
    function GetQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }

</script>

<!--获取数据，渲染模板-->
<script type="text/javascript">

    layui.use('layer', function () {

        // ajax交互，JS中以定义的layer无法获取（猜测），手动定义一个
        // 定义layer，用于打印提示信息
        var layer = layui.layer;

        // 用户活跃榜数据
        var active_user;
        // ajax-用户活跃榜数据获取
        $.ajax({
            type: 'post',
            url: '/count/getActiveUser.do',
            dataType: 'json',
            async: false,
            success: function (data) {
                active_user = data.data;
            },
            error: function (data) {
                layer.msg("获取用户活跃榜失败！");
            }
        })

        // 用户中心数据
        var user_info;
        // ajax-用户数据中心数据获取
        $.ajax({
            type: 'post',
            url: '/user/userCenter.do',
            data: {},
            dataType: 'json',
            async: false,
            success: function (data) {
                user_info = data.data;
            },
            error: function (data) {
                layer.msg("获取用户中心数据失败！");
            }
        })

        // 右侧公告板数据
        var noticeBoard;
        // ajax-右侧公告板数据获取
        $.ajax({
            type: 'post',
            url: '/post/getNoticeBoard.do',
            dataType: 'json',
            async: false,
            success: function (data) {
                noticeBoard = data.data;
            },
            error: function (data) {
                layer.msg("获取公告板数据失败！");
            }
        })

        // 导航栏数据
        var guide_bar;
        // ajax-导航栏数据获取
        $.ajax({
            type: 'post',
            url: '/section/getSection.do',
            dataType: 'json',
            async: false,
            success: function (data) {
                guide_bar = data.data;
            },
            error: function (data) {
                layer.msg("获取板块信息失败！");
            }
        })

        // 置顶帖数据
        var sticky;
        // ajax-置顶帖数据获取
        $.ajax({
            type: 'post',
            url: '/post/getAllSticky.do',
            dataType: 'json',
            async: false,
            success: function (data) {
                sticky = data.data;
            },
            error: function (data) {
                layer.msg("获取置顶帖失败！");
            }
        })

        // 热门帖数据
        var hot_post;
        // ajax-获取热门帖数据
        $.ajax({
            type: 'post',
            url: '/post/getHotPost.do',
            dataType: 'json',
            async: false,
            success: function (data) {
                hot_post = data.data;
            },
            error: function (data) {
                layer.msg("获取热门帖失败！");
            }
        })

        // 帖子列表数据
        var post;
        // ajax-获取帖子列表
        $.ajax({
            type: 'post',
            url: '/post/getPostByPtime.do',
            dataType: 'json',
            data: {
                page: page,
                kind: kind,
                order: order
            },
            async: false,
            success: function (data) {
                post = data.data;
                page++;
            },
            error: function (data) {
                layer.msg("获取帖子列表失败！");
            }
        })

        // 帖子列表数据
        var checkin;
        // ajax-获取帖子列表
        $.ajax({
            type: 'post',
            url: '/checkin/getUserCheckinInfo.do',
            dataType: 'json',
            async: false,
            success: function (data) {
                checkin = data.data;
            },
            error: function (data) {
                layer.msg("调取【获取签到信息】服务失败！");
            }
        })

        // 模板引擎渲染
        layui.use('laytpl', function () {
            // 定义一个模板引擎
            laytpl = layui.laytpl;

            // 用户中心渲染
            var center_model = document.getElementById('m_center').innerHTML;
            var center_view = document.getElementById('center');
            laytpl(center_model).render(user_info, function (html) {
                center_view.innerHTML = html;
            });

            // 社区公告板渲染
            var notice_model = document.getElementById('m_notice').innerHTML;
            var notice_view = document.getElementById('notice');
            laytpl(notice_model).render(noticeBoard, function (html) {
                notice_view.innerHTML = html;
            });

            // 板块导航渲染
            var guide_bar_model = document.getElementById('m_guide_bar').innerHTML;
            var guide_bar_view = document.getElementById('guide_bar');
            laytpl(guide_bar_model).render(guide_bar, function (html) {
                guide_bar_view.innerHTML = html;
            });

            // 置顶渲染
            var sticky_model = document.getElementById('m_post').innerHTML;
            var sticky_view = document.getElementById('sticky');
            laytpl(sticky_model).render(sticky, function (html) {
                sticky_view.innerHTML = html;
            });

            // 热门帖子渲染
            var hot_post_model = document.getElementById('m_hot_post').innerHTML;
            var hot_post_view = document.getElementById('hot_post');
            laytpl(hot_post_model).render(hot_post, function (html) {
                hot_post_view.innerHTML = html;
            });

            // 帖子列表渲染
            var post_model = document.getElementById('m_post').innerHTML;
            var post_view = document.getElementById('post');
            laytpl(post_model).render(post, function (html) {
                // 当前只写了获取之前当前页所有数据的方法，是否使用追加有待商讨
                // 更新innerHTML，获取数据量越来越大，需要获取当前页之前所有数据，适用于实时更新
                post_view.innerHTML = html;
                // 追加innerHTML，获取数据量小，只用获取新页面的数据，适用于不实时更新
                // post_view.innerHTML += html;
            });

            // 活跃用户榜单
            var active_user_model = document.getElementById('m_active_user').innerHTML;
            var active_user_view = document.getElementById('active_user');
            laytpl(active_user_model).render(active_user, function (html) {
                active_user_view.innerHTML = html;
            });

            // 签到模块渲染
            if (checkin !== null) {
                var checkin_model = document.getElementById('m_checkin').innerHTML;
                var checkin_view = document.getElementById('checkin');
                laytpl(checkin_model).render(checkin, function (html) {
                    checkin_view.innerHTML = html;
                });
            }
        });

    })

</script>

<!--社区工具栏-->
<script>
    layui.use('layer', function () { //独立版的layer无需执行这一句
        var $ = layui.jquery, layer = layui.layer; //独立版的layer无需执行这一句
        //触发事件
        var active = {
            offset: function (othis) {
                var type = othis.data('type');
                var text = '<input type="text" id="license" lay-verify="title" autocomplete="off" placeholder="请输入车牌号..." class="layui-input">';
                layer.open({
                    type: 1
                    , offset: type //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
                    , id: 'layerDemo' + type //防止重复弹出
                    , content: '<div style="padding: 20px 100px;">' + text + '</div>'
                    , btn: '查询'
                    , btnAlign: 'c' //按钮居中
                    , shade: 0 //不显示遮罩
                    , yes: function () {
                        var license = $("#license").val();
                        $.ajax({
                            type: 'post',
                            url: '/user/getUserByLicense.do',
                            dataType: 'json',
                            data: {
                                license: license
                            },
                            success: function (data) {
                                layer.alert(data.data.name + data.data.phone);
                            },
                            error: function (data) {
                                layer.msg("查询失败！");
                            }
                        })
                        // layer.closeAll();
                    }
                });
            }
        };
        $('.tool').on('click', function () {
            var othis = $(this), method = othis.data('method');
            active[method] ? active[method].call(this, othis) : '';
        });

    });
</script>

</html>