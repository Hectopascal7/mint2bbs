<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>薄荷社区-首页</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="薄荷社区">
    <meta name="description" content="薄荷社区,MintBBS,橙色薄荷°">
    <link rel="icon" href="/image/favicon.ico">
    <link rel="stylesheet" href="/script/layui/css/layui.css">
    <link rel="stylesheet" href="/css/global.css">
    <script src="/script/jquery-3.3.1.min.js"></script>
</head>
<body>
<!--头部-->
<div class="fly-header layui-bg-black">
    <div class="layui-container">
        <a class="fly-logo" href="/">
            <img src="/image/logo.png" alt="layui">
        </a>
        <!-- 论坛主标题区 -->
        <ul class="layui-nav fly-nav layui-hide-xs">
            <li class="layui-nav-item layui-this">
                <a href="/"><i class="iconfont icon-jiaoliu"></i>业主论坛</a>
            </li>
            <li class="layui-nav-item">
                <a href="/page/portal/market/market.html"><i class="iconfont icon-iconmingxinganli"></i>交易市场</a>
            </li>
            <li class="layui-nav-item">
                <a href="http://www.layui.com/" target="_blank"><i class="iconfont icon-ui"></i>吐槽区</a>
            </li>
        </ul>
        <!-- 用户个人中心功能区 -->
        <ul class="layui-nav fly-nav-user">
            <!-- 登入后的状态 -->
            <li class="layui-nav-item">
                <a class="fly-nav-avatar" href="javascript:;" id="center">
                    <!--<cite class="layui-hide-xs">橙色薄荷°</cite>-->
                    <!--<i class="iconfont icon-renzheng layui-hide-xs" title="认证信息：管理员"></i>-->
                    <!--<i class="layui-badge fly-badge-vip layui-hide-xs">管理员</i>-->
                    <!--<img src="../../../image/asuna.jpg">-->
                </a>
                <dl class="layui-nav-child">
                    <dd>
                        <a href="page/portal/user/home.html"><i class="layui-icon"
                                                                style="margin-left: 2px; font-size: 22px;">&#xe68e;</i>我的主页</a>
                    </dd>
                    <dd>
                        <a href="page/portal/user/message.html"><i class="iconfont icon-tongzhi" style="top: 4px;"></i>我的消息</a>
                    </dd>
                    <dd>
                        <a href="page/portal/user/setting.html"><i class="layui-icon">&#xe620;</i>基本设置</a>
                    </dd>
                    <hr style="margin: 5px 0;">
                    <dd><a href="" style="text-align: center;">退出</a></dd>
                </dl>
            </li>
        </ul>
    </div>
</div>
<div class="fly-panel fly-column">
    <div class="layui-container" id="guidebar">

    </div>
</div>
<div class="layui-container">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md8">
            <div class="fly-panel">
                <div class="fly-panel-title fly-filter">
                    <a>置顶</a>
                    <a href="#signin" class="layui-hide-sm layui-show-xs-block fly-right" id="LAY_goSignin"
                       style="color: #FF5722;">去签到</a>
                </div>
                <ul class="fly-list" id="sticky">

                </ul>
            </div>

            <!--第二板块：回帖-->
            <div class="fly-panel" style="margin-bottom: 0;">
                <div class="fly-panel-title fly-filter">
                    <a href="" class="layui-this">综合</a>
                    <span class="fly-mid"></span>
                    <a href="">精华</a>
                    <span class="fly-filter-right layui-hide-xs">
                        <a href="" class="layui-this">按最新</a>
                        <span class="fly-mid"></span>
                        <a href="">按热议</a>
                    </span>
                </div>

                <!--帖子列表区-->
                <ul class="fly-list" id="post"></ul>

                <div style="text-align: center">
                    <div class="laypage-main">
                        <a class="laypage-next" href="javascript:getMore()">更多帖子</a>
                    </div>
                </div>

            </div>
        </div>
        <div class="layui-col-md4">

            <div class="fly-panel" id="notice"></div>

            <div class="fly-panel fly-signin">
                <div class="fly-panel-title">
                    签到
                    <i class="fly-mid"></i>
                    <a href="javascript:;" class="fly-link" id="LAY_signinHelp">说明</a>
                    <i class="fly-mid"></i>
                    <a href="javascript:;" class="fly-link" id="LAY_signinTop">活跃榜<span class="layui-badge-dot"></span></a>
                    <span class="fly-signin-days">已连续签到<cite>16</cite>天</span>
                </div>
                <div class="fly-panel-main fly-signin-main">
                    <button class="layui-btn layui-btn-danger" id="LAY_signin">今日签到</button>
                    <span>可获得<cite>5</cite>积分</span>

                    <!-- 已签到状态 -->
                    <!--
                    <button class="layui-btn layui-btn-disabled">今日已签到</button>
                    <span>获得了<cite>20</cite>飞吻</span>
                    -->
                </div>
            </div>

            <div class="fly-panel fly-rank fly-rank-reply" id="LAY_replyRank">
                <h3 class="fly-panel-title">回帖榜</h3>
                <dl id="active_user"></dl>
            </div>

            <dl class="fly-panel fly-list-one" id="hot_post"></dl>

            <div class="fly-panel">
                <div class="fly-panel-title">
                    社区工具栏
                </div>
                <div class="fly-panel-main">
                    <a href="" target="_blank" class="fly-zanzhu"
                       time-limit="2017.09.25-2099.01.01" style="background-color: #5FB878;">车牌号查询</a>
                </div>
            </div>

            <div class="fly-panel fly-list-one">


                <dt class="fly-panel-title">社区管理组</dt>
                <dl class="fly-panel-main">
                    <table>
                        <tr>
                            <td>
                                <dd>
                                    居委会：
                                </dd>
                            </td>
                            <td>
                                <dd>橙色薄荷°——17863909380</dd>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <dd>
                                    物业：
                                </dd>
                            </td>
                            <td>
                                <dd>橙色薄荷°——17863909380</dd>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <dd>
                                    保卫处：
                                </dd>
                            </td>
                            <td>
                                <dd>橙色薄荷°——17863909380</dd>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <dd>
                                    值班室：
                                </dd>
                            </td>
                            <td>
                                <dd>橙色薄荷°——17863909380</dd>
                            </td>
                        </tr>
                    </table>
                    <!--<dd>-->
                    <!--<a href="http://layim.layui.com/" target="_blank">物业负责人：橙色薄荷°——17863909380</a>-->
                    <!--</dd>-->
                    <!--<dd>-->
                    <!--<a href="http://layer.layui.com/" target="_blank">保卫处负责人：橙色薄荷°——17863909380</a>-->
                    <!--</dd>-->
                    <!--<dd>-->
                    <!--<a href="http://layer.layui.com/" target="_blank">值班室负责人：橙色薄荷°——17863909380</a>-->
                    <!--</dd>-->
                    <!--<dd>-->
                    <!--<a href="mailto:xianxin@layui-inc.com?subject=%E7%94%B3%E8%AF%B7Fly%E7%A4%BE%E5%8C%BA%E5%8F%8B%E9%93%BE"-->
                    <!--class="fly-link">商务洽谈：mint_com@163.com</a>-->
                    <!--</dd>-->
                </dl>
            </div>
        </div>
    </div>
</div>

<div class="fly-footer">
    <p>
        <a href="http://fly.layui.com/" target="_blank">薄荷社区</a> 2019 &copy;
        <a href="http://www.layui.com/" target="_blank">橙色薄荷° 出品</a>
    </p>
    <p>
        <a href="http://fly.layui.com/jie/3147/" target="_blank">Copyright &copy; 2019 橙色薄荷° All Rights Reserved.</a>
    </p>
</div>

<script src="/script/layui/layui.js"></script>
<script>
    layui.cache.page = '';
    layui.cache.user = {
        username: '游客'
        , uid: -1
        , avatar: '/image/avatar/00.jpg'
        , experience: 83
        , sex: '男'
    };
    layui.config({
        version: "3.0.0"
        , base: '/script/mods/' //这里实际使用时，建议改成绝对路径
    }).extend({
        fly: 'index'
    }).use('fly');
</script>

<!--<script type="text/javascript">-->
<!--var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");-->
<!--document.write(unescape("%3Cspan id='cnzz_stat_icon_30088308'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "w.cnzz.com/c.php%3Fid%3D30088308' type='text/javascript'%3E%3C/script%3E"));-->
<!--</script>-->


</body>

<!--用户中心模板-->
<script id="m_center" type="text/html">
    <cite class="layui-hide-xs">{{ d.nickname }}</cite>
    {{#  if(d.role === 1){ }}
    <i class="iconfont icon-renzheng layui-hide-xs" title="认证信息：管理员"></i>
    <i class="layui-badge fly-badge-vip layui-hide-xs" title="积分 {{d.point}}">Lv.3</i>
    {{#  } }}
    <img src="{{ d.profile }}">
</script>

<script id="m_guidebar" type="text/html">
    <ul class="layui-clear">
        {{# layui.each(d, function(index, item){ }}
        <li><a href="/page/portal/section.html">{{item.sname}}</a></li>
        {{# }); }}
        <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><span class="fly-mid"></span></li>
        <!--用户登入后显示-->
        <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><a href="user/index.html">我的贴子</a></li>
        <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><a
                href="user/index.html#collection">收藏</a>
        </li>
    </ul>
    <div class="fly-column-right layui-hide-xs">
            <span class="fly-search">
                <i class="layui-icon"></i>
            </span>
        <a href="page/portal/topic/add.html?section=123" class="layui-btn">发表新帖</a>
    </div>
    <!--<div class="layui-hide-sm layui-show-xs-block"-->
    <!--style="margin-top: -10px; padding-bottom: 10px; text-align: center;">-->
    <!--<a href="jie/add.html" class="layui-btn">发表新帖</a>-->
    <!--</div>-->
</script>

<!--公告板模板-->
<script id="m_notice" type="text/html">
    <h3 class="fly-panel-title">社区公告</h3>
    <ul class="fly-panel-main fly-list-static">
        {{# layui.each(d, function(index, item){ }}
        <li>
            <a href="/page/portal/topic/detail.html?nid={{item.nid}}" target="_blank">{{ item.title }}</a>
            <!--<span>{{ item.ptime }}</span>-->
        </li>
        {{# }); }}
    </ul>
</script>

<!--置顶区模板-->
<script id="m_sticky" type="text/html">
    {{# for(var i = 0 ; i < d.length; i++){ }}
    <li>
        <a href="user/home.html" class="fly-avatar">
            <img src="image/asuna.jpg" alt="橙色薄荷°">
        </a>
        <h2>
            <a class="layui-badge">{{ d[i].sname }}</a>
            <a href="page/portal/topic/detail.html?tid={{ JSON.parse(d[i].post).tid}}&sid={{ JSON.parse(d[i].post).sid}}">{{
                JSON.parse(d[i].post).title}}</a>
        </h2>
        <div class="fly-list-info">
            <a href="user/home.html" link>
                <cite>{{ d[i].nickname }}</cite>
                {{# if(d[i].role == 1){ }}
                <i class="iconfont icon-renzheng" title="认证信息：管理员"></i>
                <i class="layui-badge fly-badge-vip">管理员</i>
                {{# } }}
                {{# if(d[i].role == 0){ }}
                <i class="layui-badge fly-badge-vip">LV3</i>
                {{# } }}
            </a>
            <span>{{ JSON.parse(d[i].post).ptime}}</span>
            <span class="layui-hide-xs" title="浏览"><i class="iconfont icon-liulanyanjing"></i> {{ JSON.parse(d[i].post).acount}}</span>
            <!--<span class="layui-badge fly-badge-accept layui-hide-xs">已结</span>-->
            <span class="fly-list-nums"><i class="iconfont icon-pinglun1" title="回复"></i> {{ JSON.parse(d[i].post).rcount}}</span>
        </div>
        <div class="fly-list-badge">
            {{# if(JSON.parse(d[i].post).isbest===1){ }}
            <span class="layui-badge layui-bg-red">精帖</span>
            {{# } }}
            {{# if(JSON.parse(d[i].post).issticky===1){ }}
            <span class="layui-badge layui-bg-black">置顶</span>
            {{# } }}
        </div>
    </li>
    {{# } }}
</script>

<!--热门帖子模板-->
<script type="text/html" id="m_hot_post">
    <dt class="fly-panel-title">本周热议</dt>
    <dl class="fly-panel-main">
        {{# if(d.length>0){ }}
        {{# for(var i = 0 ; i < d.length; i++){ }}
        <dd>
            <a href="jie/detail.html">{{ d[i].title }}</a>
            <span><i class="iconfont icon-pinglun1"></i> {{ d[i].acount+d[i].rcount }}</span>
        </dd>
        {{# } }}
        {{# } }}
    </dl>
    {{# if(d.length===0){ }}
    <!-- 无数据时 -->
    <div class="fly-none">没有相关数据</div>
    {{# } }}
</script>

<!--帖子列表区模板-->
<script type="text/html" id="m_post">
    {{# for(var i = 0 ; i < d.length; i++){ }}
    <li>
        <a href="user/home.html" class="fly-avatar">
            <img src="image/asuna.jpg" alt="橙色薄荷°">
        </a>
        <h2>
            <a class="layui-badge">{{ d[i].section.sname }}</a>
            <a href="jie/detail.html">{{ d[i].post.title }}</a>
        </h2>
        <div class="fly-list-info">
            <a href="user/home.html" link>
                <cite>{{ d[i].user.nickname }}</cite>
                {{# if(d[i].user.role===1){ }}
                <i class="iconfont icon-renzheng" title="认证信息：XXX"></i>
                <i class="layui-badge fly-badge-vip">管理员</i>
                {{# } }}
            </a>
            <span>{{ d[i].post.ptime }}</span>
            <span class="layui-hide-xs" title="浏览"><i
                    class="iconfont icon-liulanyanjing"></i> {{ d[i].post.acount }}</span>
            <!--<span class="layui-badge fly-badge-accept layui-hide-xs">已结</span>-->
            <span class="fly-list-nums">
                <i class="iconfont icon-pinglun1" title="回答"></i> {{ d[i].post.rcount }}
            </span>
        </div>
        <div class="fly-list-badge">
            {{# if(d[i].post.isbest===1){ }}
            <span class="layui-badge layui-bg-red">精帖</span>
            {{# } }}
            {{# if(d[i].post.issticky===1){ }}
            <span class="layui-badge layui-bg-black">置顶</span>
            {{# } }}
        </div>
    </li>
    {{# } }}
</script>

<!--活跃用户榜单-->
<script type="text/html" id="m_active_user">
    <!--<i class="layui-icon fly-loading">&#xe63d;</i>-->
    {{# layui.each(d, function(index, item){ }}
    <dd>
        <a href="user/home.html">
            <img src="image/asuna.jpg"><cite>{{item.nickname}}</cite><i>活跃度 {{item.count}}</i>
        </a>
    </dd>
    {{# }); }}
</script>

<!--获取数据，渲染模板-->
<script type="text/javascript">

    var user_info;
    $.ajax({
        type: 'post',
        url: '/user/userCenter.do',
        data: {},
        dataType: 'json',
        async: false,
        success: function (data) {
            user_info = data.data;
        },
        error: function (data) {
            alert("获取公告板失败！");
        }
    })

    var noticeBoard;
    $.ajax({
        type: 'post',
        url: '/post/getNoticeBoard.do',
        dataType: 'json',
        async: false,
        success: function (data) {
            noticeBoard = data.data;
        },
        error: function (data) {
        }
    })

    var guideBar;
    $.ajax({
        type: 'post',
        url: '/section/getSection.do',
        dataType: 'json',
        async: false,
        success: function (data) {
            guideBar = data.data;
        },
        error: function (data) {
            alert("获取论坛版块失败！");
        }
    })

    var sticky;
    $.ajax({
        type: 'post',
        url: '/post/getAllSticky.do',
        dataType: 'json',
        async: false,
        success: function (data) {
            sticky = data.data;
        },
        error: function (data) {
            alert("获取置顶模块失败！");
        }
    })

    var hot_post;
    $.ajax({
        type: 'post',
        url: '/post/getHotPost.do',
        dataType: 'json',
        async: false,
        success: function (data) {
            hot_post = data.data;
        },
        error: function (data) {
            alert("获取热门模块失败！");
        }
    })

    var page = 1;
    var post;
    $.ajax({
        type: 'post',
        url: '/post/getPostByPtime.do',
        dataType: 'json',
        data: {
            page: page
        },
        async: false,
        success: function (data) {
            post = data.data;
            page++;
        },
        error: function (data) {
            alert("获取热门模块失败！");
        }
    })

    var active_user;
    $.ajax({
        type: 'post',
        url: '/count/getActiveUser.do',
        dataType: 'json',
        async: false,
        success: function (data) {
            active_user = data.data;
        },
        error: function (data) {
            alert("获取活跃用户榜单失败！");
        }
    })

    function getMore(){
        $.ajax({
            type: 'post',
            url: '/post/getPostByPtime.do',
            dataType: 'json',
            data: {
                page: page
            },
            async: false,
            success: function (data) {
                post = data.data;
                page++;
            },
            error: function (data) {
                alert("获取热门模块失败！");
            }
        })

        layui.use('laytpl', function () {
            laytpl = layui.laytpl;

            // 帖子列表渲染
            var post_model = document.getElementById('m_post').innerHTML;
            var post_view = document.getElementById('post');
            laytpl(post_model).render(post, function (html) {
                post_view.innerHTML = html;
            });

        });
    }

    layui.use('laytpl', function () {
        laytpl = layui.laytpl;

        // 用户中心渲染
        var center_model = document.getElementById('m_center').innerHTML;
        var center_view = document.getElementById('center');
        laytpl(center_model).render(user_info, function (html) {
            center_view.innerHTML = html;
        });

        // 社区公告板渲染
        var notice_model = document.getElementById('m_notice').innerHTML;
        var notice_view = document.getElementById('notice');
        laytpl(notice_model).render(noticeBoard, function (html) {
            notice_view.innerHTML = html;
        });

        // 板块导航渲染
        var guidebar_model = document.getElementById('m_guidebar').innerHTML;
        var guidebar_view = document.getElementById('guidebar');
        laytpl(guidebar_model).render(guideBar, function (html) {
            guidebar_view.innerHTML = html;
        });

        // 置顶渲染
        var sticky_model = document.getElementById('m_sticky').innerHTML;
        var sticky_view = document.getElementById('sticky');
        laytpl(sticky_model).render(sticky, function (html) {
            sticky_view.innerHTML = html;
        });

        // 热门帖子渲染
        var hot_post_model = document.getElementById('m_hot_post').innerHTML;
        var hot_post_view = document.getElementById('hot_post');
        laytpl(hot_post_model).render(hot_post, function (html) {
            hot_post_view.innerHTML = html;
        });

        // 帖子列表渲染
        var post_model = document.getElementById('m_post').innerHTML;
        var post_view = document.getElementById('post');
        laytpl(post_model).render(post, function (html) {
            post_view.innerHTML = html;
        });

        // 活跃用户榜单
        var active_user_model = document.getElementById('m_active_user').innerHTML;
        var active_user_view = document.getElementById('active_user');
        laytpl(active_user_model).render(active_user, function (html) {
            active_user_view.innerHTML = html;
        });
    });
</script>
</html>